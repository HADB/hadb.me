---
title: 自建 NAS 及 DDNS
date: 2016-11-21
tags: ['日记', 'HomeLab', 'NAS']
---

众所周知的原因，前段时间 360 云盘也倒下了，之前大部分照片、电影资源都放在 360 云盘上。由于国内的环境，感觉第三方云盘的可靠程度还不如自己建个 NAS。前端时间研究了硬件方案，今天研究了下外网访问的方案。

固定 IP 肯定是拉不起，太贵了，国内运营商太黑心。只能通过 DDNS，但花生壳这种我也不想用，以前试用过，速度太慢。既然是程序猿，还是自己来吧。具体方案如下：

1. 阿里云的云解析 DNS，升级付费版，将最低 TTL 值拉到 1 秒，其余都拉成最低配置，一年 40.8 块钱，完全可以接受。
2. 在自己的阿里云服务器上搭建一个小站点，用于返回来访请求的公网 IP 地址。没有外网服务器的，可以利用 ip138 的服务来做，[http://city.ip138.com/ip2city.asp](http://city.ip138.com/ip2city.asp)。
3. 做一个小应用，跑在 NAS 上，每秒向步骤 2 中的站点请求获取 NAS 的外网 IP，并通过阿里云云解析 DNS 的 api 接口，更新域名的 IP 地址，并记录，如果下次请求 IP 不变则跳过，IP 变化了则更新。做好日志，运行一段时间之后看下电信的动态 ip 更换有没有规律，可以适当调整获取外网 IP 的频率。
